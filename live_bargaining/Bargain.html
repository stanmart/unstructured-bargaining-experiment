{{ block head }}
<link rel="stylesheet" href="{{ static 'live_bargaining.css' }}">
{{ endblock }}

{{ block title }}
Make a deal
{{ endblock }}

{{ block content }}

<div class="side-by-side">
    <div class="flex">
        <p>
            This is a 5-player game.
            Any subset of the players can form a coalition.
            The value the coalition can produce depends on its members like so:
            <ul>
                <li>If Player 0 is not in the coalition, the value is 0.</li>
                <li>Otherwise, it is increasing in the number of members (see graph).</li>
            </ul>
        </p>
        <p>
            You are <span style="color: #056fb7; font-weight: bold;">Player {{ player.id_in_group }}</span>.
            Please negotiate with the other players below.
        </p>
    </div>
    <div>
        <canvas id="payoff-chart"></canvas>
    </div>
</div>

<div class="section">
    <h3>Propose allocation</h2>    
    <table class="offer-table">
        <tbody>
            <tr>
                <th></th>
                <th class="offer-player-col player-1">Player 1</th>
                <th class="offer-player-col player-2">Player 2</th>
                <th class="offer-player-col player-3">Player 3</th>
                <th class="offer-player-col player-4">Player 4</th>
                <th class="offer-player-col player-5">Player 5</th>
                <th style="text-align: right;">Total</th>
            </tr>
            <tr style="height: 3em;">
                <th class="offer-left-col">In coalition</th>
                <td class="offer-player-col"><input type="checkbox" class="coalition-member" id="is-member-1"></td>
                <td class="offer-player-col"><input type="checkbox" class="coalition-member" id="is-member-2"></td>
                <td class="offer-player-col"><input type="checkbox" class="coalition-member" id="is-member-3"></td>
                <td class="offer-player-col"><input type="checkbox" class="coalition-member" id="is-member-4"></td>
                <td class="offer-player-col"><input type="checkbox" class="coalition-member" id="is-member-5"></td>
                <td class="offer-total-col"><div class="allocation-total" id="total-shareable">0</div></td>
            </tr>
            <tr style="height: 3em;">
                <th class="offer-left-col">Allocation</th>
                <td class="offer-player-col"><input type="number" disabled="true", value="0", class="allocation" id="allocation-1"></td>
                <td class="offer-player-col"><input type="number" disabled="true", value="0", class="allocation" id="allocation-2"></td>
                <td class="offer-player-col"><input type="number" disabled="true", value="0", class="allocation" id="allocation-3"></td>
                <td class="offer-player-col"><input type="number" disabled="true", value="0", class="allocation" id="allocation-4"></td>
                <td class="offer-player-col"><input type="number" disabled="true", value="0", class="allocation" id="allocation-5"></td>
                <td class="offer-total-col"><div class="allocation-total" id="total-shared">0</div></td>
            </tr>
        </tbody>
        <tr>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td style="text-align: right;"><button type="button" onclick="sendOffer()" id="btn-propose" style="width: 100%">Submit</button></td>
        </tr>
    </table>
</div>

<div class="section">
    <h3>Accept proposal</h2>    
    <table class="offer-table">
        <tbody>
            <tr>
                <th></th>
                <th class="offer-player-col player-1">Player 1</th>
                <th class="offer-player-col player-2">Player 2</th>
                <th class="offer-player-col player-3">Player 3</th>
                <th class="offer-player-col player-4">Player 4</th>
                <th class="offer-player-col player-5">Player 5</th>
                <th style="text-align: right;"></th>
            </tr>
            <tr style="height: 3em;">
                <th class="offer-left-col">Accepted proposal</th>
                <td class="offer-player-col"><input disabled="true", value="", class="allocation" id="accepted-1"></td>
                <td class="offer-player-col"><input disabled="true", value="", class="allocation" id="accepted-2"></td>
                <td class="offer-player-col"><input disabled="true", value="", class="allocation" id="accepted-3"></td>
                <td class="offer-player-col"><input disabled="true", value="", class="allocation" id="accepted-4"></td>
                <td class="offer-player-col"><input disabled="true", value="", class="allocation" id="accepted-5"></td>
                <td><button type="button" onclick="acceptProposal()" id="btn-accept" style="width: 100%">Submit</button></td>
            </tr>
            <tr style="height: 3em;">
                <th class="offer-left-col">Implied payoff</th>
                <td class="offer-player-col"><div class="allocation" id="payoff-1"></div></td>
                <td class="offer-player-col"><div class="allocation" id="payoff-2"></div></td>
                <td class="offer-player-col"><div class="allocation" id="payoff-3"></div></td>
                <td class="offer-player-col"><div class="allocation" id="payoff-4"></div></td>
                <td class="offer-player-col"><div class="allocation" id="payoff-5"></div></td>
                <td></td>
            </tr>
        </tbody>
    </table>
</div>

<div class="side-by-side" style="height: 500px;">

    <div class="section flex-item vertical-fill">
        <h3>Chat</h3>
        {{ chat nickname=player.role }} 
    </div>
    
    <div class="section flex-item vertical-fill">
        <h3>Past Proposals</h4>
        <div class="flex-item vertical-fill" style="overflow-y: auto;">
            <table class="offer-table horizontal-rules">
                <thead>
                    <tr>
                        <th class="offer-left-col">From</th>
                        <th class="offer-id-col">ID</th>
                        <th class="offer-player-col player-1">P1</th>
                        <th class="offer-player-col player-2">P2</th>
                        <th class="offer-player-col player-3">P3</th>
                        <th class="offer-player-col player-4">P4</th>
                        <th class="offer-player-col player-5">P5</th>
                    </tr>
                </thead>
                <tbody id="past-offers-table"></tbody>
            </table>
        </div>
    </div>
        
</div>


<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="{{ static 'live_bargaining.js' }}"></script>

{{ endblock }}
